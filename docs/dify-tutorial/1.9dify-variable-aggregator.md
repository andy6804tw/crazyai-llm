# Dify 工作流基礎：變量聚合器

**變量聚合器**是一個能夠將多路分支的輸出變數整合為單一變數的節點。
它依靠變數聚合機制，將不同分支的結果匯總到同一個變數中，供下游節點統一使用。這樣能避免重複定義、減少冗餘，並讓工作流更加簡潔與高效。

常見應用包括：

* 多個條件分支結果的合流
* 問題分類後的多路輸出整合
* 相同類型資料（文字、數字、檔案）的集中管理

![](./images/img-variable-aggregator-1.png)

---

## 使用方法

在工作流中配置 **變量聚合器** 節點時，通常包含以下幾個步驟：

1. **選擇輸入來源**
   從多個分支節點輸出變數中，選取需要聚合的目標。

2. **確保資料型別一致**
   聚合器只能處理同一類型的變數，例如：全是字串、或全是數字。若第一個輸入為 `String`，後續只能加入 `String`。

3. **定義聚合結果**
   指定聚合後的統一變數名稱，方便後續節點直接引用。

4. **連接下游節點**
   將聚合後的變數，傳遞給下一個節點（如知識庫檢索、LLM、直接回覆等）。

![](./images/img-variable-aggregator-2.png)

---

### 高級設定

* **聚合分組**
  允許一次聚合多組變數，每組需保持相同的資料型別。
  例如：第一組為 `String`，第二組為 `Number`。

* **支援型別**

  * 字串（`String`）
  * 數字（`Number`）
  * 檔案（`File`）
  * 物件（`Object`）
  * 陣列（`Array`）

---

## 實務案例（場景）

### 案例一：問題分類器聚合

若問題分類器將輸入分為三類（售前、售後、其他），每個分支都連接到各自的知識庫檢索節點。
沒有變量聚合器時，每個檢索結果需要單獨處理，造成下游 LLM 與回覆節點重複定義。

透過變量聚合器，三個知識檢索結果可以統一聚合成一個變數，再傳遞給下游節點，流程更簡潔。

![](./images/img-variable-aggregator-3.png)

---

### 案例二：IF/ELSE 條件分支聚合

假設隨機數字被分流到三個分支，每個分支都執行相同的資料處理。
若不聚合，下游需要維護三套重複節點；使用變量聚合器後，三路輸出合併成一個變數，下游只需處理一次即可。

這樣從原本 300 個節點縮減到 100 個，大幅提升維護效率，降低錯誤率。

![](./images/img-variable-aggregator-4.png)

---

透過 **變量聚合器**，我們能將「分散的水流」彙整成一條「主水管」，不僅讓流程更乾淨有序，也避免了資源浪費，實現更高效的工作流設計。

