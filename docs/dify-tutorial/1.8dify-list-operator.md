# Dify 工作流基礎：列表操作

**列表操作** 是一個能夠從陣列變數中提取、篩選與排序特定元素的節點。  
它主要用於處理 `Array[File]` 類型的輸入，例如使用者同時上傳多個檔案（圖片、文檔、音訊或影片），可透過此節點進行分類分流，將不同檔案傳送至各自的處理流程。

這個節點在多檔案上傳應用中特別常見，例如「文件問答」或「多模態輸入」場景，可讓工作流更精準地控制資料流向，提升自動化程度。

常見應用包括：

* 同時處理圖片與文檔上傳
* 篩選出特定副檔名或類型的檔案
* 從多筆資料中取前幾筆進行分析或摘要

![](./images/608c1bb4-439d-498a-ad97-292c94a67dcc.png)

---

## 使用方法

在 Dify 工作流中配置 **列表操作** 節點時，主要包含以下幾個步驟：

1. **輸入變數**

列表操作節點僅接受以下陣列類型輸入：

* `Array[string]`
* `Array[number]`
* `Array[file]`

最常見的是 `Array[file]`，例如：  
`[1.mp3, 2.png, 3.doc]`

!!! note

    LLM 僅能處理單一文件或圖片輸入，因此若直接傳入整個陣列，模型將無法辨識，必須先經由列表操作節點分拆後再輸入下游節點。

---

2. **設定篩選條件**

可根據檔案屬性設定篩選條件，提取出符合條件的項目。  
支援的屬性如下：

| 屬性 | 說明 |
|------|------|
| **type** | 文件類型，如 image、document、audio、video |
| **size** | 檔案大小 |
| **name** | 檔案名稱 |
| **url** | 若為使用者透過 URL 上傳，可指定完整網址進行篩選 |
| **extension** | 副檔名，如 `.png`、`.pdf` |
| **mime_type** | [MIME Type](https://datatracker.ietf.org/doc/html/rfc2046)，例如 `"text/html"` |
| **transfer_method** | 上傳方式（Local Upload 或 URL Upload） |

> 例如：  
> 若設定條件為「`type = image`」，則只會輸出圖片類型檔案。

![](./images/4ad96e06-c335-4e7a-a2cb-728640a73abb.png)

---

3. **排序與限制（可選）**

* **排序方式**
  * 升序（ASC）：由小到大 / A → Z  
  * 降序（DESC）：由大到小 / Z → A  
  可根據檔案名稱、大小或上傳時間排序。

* **取前 N 項**
  - 可設定取出前 N 筆資料（1～20），常用於僅處理最新或特定數量的檔案。

---

4. **輸出變數**

根據篩選與排序條件，節點輸出結果如下：

| 變數名稱 | 說明 |
|-----------|------|
| **result** | 篩選結果，型別為陣列 |
| **first_record** | 篩選後的第一個元素（`result[0]`） |
| **last_record** | 篩選後的最後一個元素（`result[-1]`） |

> 若僅篩選出一個檔案，則 `result` 會只包含單一元素。

---

## 高級設定

* **多條件組合**：可同時設定多個篩選條件（AND / OR）。
* **動態變數**：可將輸入條件以變數代入，支援上下文邏輯。
* **結果限制**：可用於分流控制，如「取第一張圖片送入 LLM」、「取前兩份文檔送入摘要器」。

---

## 實務案例：文件與圖片分流處理

### 🎯 案例說明

在文件問答場景中，使用者可能同時上傳文檔與圖片。  
由於 LLM 僅能解析圖片內容，文檔部分需交由 **文檔提取器（Doc Extractor）** 處理。  
因此可使用兩個 **列表操作** 節點分別篩選圖片與文檔，並導向不同的後續節點。

---

### 🔧 設定步驟

1. 在「開始（Start）」節點中啟用檔案上傳功能，允許「圖片」與「文檔」兩種格式。
2. 新增兩個 **列表操作** 節點：
   - `IMAGE`：條件為 `type = image`
   - `DOCS`：條件為 `type = document`
3. `DOCS` 輸出結果傳給 **文檔提取器（Doc Extractor）**
4. `IMAGE` 輸出結果傳給 **LLM 節點**（如 Gemini 1.5 Flash）
5. 最後透過 **直接回覆節點（Answer）** 統一輸出結果。

![](./images/7910033f-a880-4cc7-9fed-bf5b8bc99346.png)

---

### 💡 範例運作結果

| 使用者上傳內容 | 列表操作結果 | 後續節點 |
|----------------|---------------|-----------|
| image01.png | type = image | 傳入 LLM |
| report.docx | type = document | 傳入文檔提取器 |
| both.png + readme.pdf | 各分流至對應節點 | 兩路並行處理 |

當使用者同時上傳圖片與文檔時，  
圖片自動傳遞至 LLM，文檔則交由 Doc Extractor，  
兩條流程最後彙整於同一個 **回覆節點**，完成「文件問答機器人」的完整處理流程。

---

## 小結

**列表操作（List Operator）** 節點能夠：

* 對陣列變數（Array）進行篩選與分流  
* 讓不同格式的檔案自動導向不同的下游節點  
* 支援排序、限制與條件組合，靈活控制資料流  
* 提升多模態應用（圖文混合輸入）的自動化能力  

它是連接上傳輸入與後續內容處理的重要橋樑，  
可與 **文檔提取器（Doc Extractor）**、**LLM 節點**、**直接回覆節點** 等組合使用，  
打造更智慧與模組化的 Dify 工作流。
